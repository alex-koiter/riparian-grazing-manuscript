{
  "hash": "6f5b05dd21add4896512cfadd3b43446",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Riparian litter WEP in response to grazing\nauthor: Alex Koiter\n---\n\n\n\n\n\n\n## Load Libraries\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(glmmTMB)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'glmmTMB' was built under R version 4.4.2\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(DHARMa)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nThis is DHARMa 0.4.6. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(emmeans)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'emmeans' was built under R version 4.4.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWelcome to emmeans.\nCaution: You lose important information if you filter this package's results.\nSee '? untidy'\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(viridis)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'viridis' was built under R version 4.4.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLoading required package: viridisLite\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(patchwork)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'patchwork' was built under R version 4.4.2\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Read in data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nconc <- read_csv(here::here(\"./notebooks/P_concentration.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRows: 1141 Columns: 8\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (5): sample_type, timing, plot, location, treatment\ndbl (3): site, ak_content, year\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nmass_data <- read_csv(here::here(\"./notebooks/mass.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nRows: 576 Columns: 8\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (5): sample_type, timing, plot, location, treatment\ndbl (3): site, dryweight, year\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Merge data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nveg_data <- mass_data %>%\n  right_join(conc) %>%\n  rename(conc = ak_content) %>% # mg/kg\n  mutate(p_total = conc * dryweight/1000 /0.25) # mg/m2\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nJoining with `by = join_by(sample_type, site, timing, plot, location, year,\ntreatment)`\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n## Litter data\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlitter_diff <- veg_data %>%\n  filter(sample_type == \"Litter\") %>%\n  mutate(dryweight = dryweight/1000 /0.25) %>%\n  pivot_longer(cols = c(dryweight, p_total, conc), names_to = \"measure\", values_to = \"value\") %>%\n  pivot_wider(names_from = timing, values_from = value) %>%\n  mutate(diff = Before - After) \n```\n:::\n\n\n\n\n\n\n\n## Litter Analysis\n### P-total\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nm4 <- glmmTMB(diff ~ treatment * location + (1|site) + (1|year),\n             data = filter(litter_diff, measure == \"p_total\"))\nsimulateResiduals(m4, n = 1000, plot = TRUE) \n```\n\n::: {.cell-output-display}\n![](02_Litter_analysis_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nObject of Class DHARMa with simulated residuals based on 1000 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. \n \nScaled residual values: 0.78 0.652 0.998 0.43 0.789 0.365 0.765 0.871 0.046 0.873 0.903 0.276 0.639 0.764 1 0.845 0.556 0.028 0.655 0.815 ...\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ncar::Anova(m4, type = \"III\") # No interaction\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type III Wald chisquare tests)\n\nResponse: diff\n                    Chisq Df Pr(>Chisq)  \n(Intercept)        2.8104  1    0.09366 .\ntreatment          2.3626  3    0.50064  \nlocation           2.4069  2    0.30015  \ntreatment:location 3.3583  6    0.76271  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\nRemoving interaction\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ntemp4 <- filter(litter_diff, measure == \"p_total\") ## otherwise issue with emmeans()\nm4 <- glmmTMB(diff ~ treatment + location + (1|site) + (1|year),\n             data = temp4)\nsimulateResiduals(m4, n = 1000, plot = TRUE)\n```\n\n::: {.cell-output-display}\n![](02_Litter_analysis_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nObject of Class DHARMa with simulated residuals based on 1000 simulations with refit = FALSE . See ?DHARMa::simulateResiduals for help. \n \nScaled residual values: 0.773 0.556 0.999 0.475 0.824 0.268 0.697 0.896 0.053 0.886 0.883 0.291 0.576 0.791 1 0.842 0.469 0.046 0.675 0.788 ...\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nperformance::check_collinearity(m4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# Check for Multicollinearity\n\nLow Correlation\n\n      Term  VIF  VIF 95% CI Increased SE Tolerance Tolerance 95% CI\n treatment 1.00 [1.00, Inf]         1.00      1.00     [0.00, 1.00]\n  location 1.00 [1.00, Inf]         1.00      1.00     [0.00, 1.00]\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\ncar::Anova(m4, type = \"III\") # No sig impact of treatment or position\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Deviance Table (Type III Wald chisquare tests)\n\nResponse: diff\n             Chisq Df Pr(>Chisq)\n(Intercept) 0.9539  1     0.3287\ntreatment   4.3023  3     0.2306\nlocation    1.1541  2     0.5615\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n### Summary\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlitter_diff %>%\n  filter(measure == \"p_total\") %>%\n  group_by(treatment) %>%\n  summarise(median = median(diff, na.rm =T),\n            mean = mean(diff, na.rm =T))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 3\n  treatment     median  mean\n  <chr>          <dbl> <dbl>\n1 Control        -1.05 -2.22\n2 High Graze     -1.39 -2.36\n3 Mow            -5.70 -7.94\n4 Regular Graze  -1.66 -6.05\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlitter_diff %>%\n  filter(measure == \"p_total\") %>%\n  group_by(location) %>%\n  summarise(median = median(diff, na.rm =T),\n            mean = mean(diff, na.rm =T))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  location median  mean\n  <chr>     <dbl> <dbl>\n1 Lower     -5.88 -5.53\n2 Middle    -2.44 -5.56\n3 Upper     -1.22 -2.72\n```\n\n\n:::\n:::\n\n\n\n\n\n\n### Plots\nReorder factors\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nplot_data <- litter_diff %>% \n  mutate(treatment = fct_recode(treatment, \"Graze\" = \"Regular Graze\")) %>%\n  mutate(treatment = fct_relevel(treatment, c(\"Control\", \"Graze\", \"High Graze\", \"Mow\"))) %>%\n  mutate(location = fct_relevel(location, c(\"Upper\", \"Middle\", \"Lower\")))\n```\n:::\n\n\n\n\n\n  \nExtra\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ndf <- data.frame(x1 = c(-Inf, -Inf), x2 = c(Inf, Inf), y2 = c(Inf, 0), y1 = c(0, -Inf), difference = c(\"Net removal\", \"Net addition\")) %>%\n  mutate(difference = fct_relevel(difference, c(\"Net removal\", \"Net addition\"))) \n```\n:::\n\n\n\n\n\n\nPlots\n\n\n\n\n\n::: {#cell-fig-litter-WEP .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-litter-WEP\n#| fig-cap: \"Change in riparian litter WEP following grazing or mowing in each of the riparian locations. No significant effect of treatment or riparian location on the litter WEP content was detected. Lower sampling locations are adjacent to the edge of the waterbody and Upper locations are adjacent to the field.\"\n#| fig-alt: \"Boxplots showing the change in riparian litter WEP following grazing or mowing.\"\n#|\np1 <- ggplot(data = filter(plot_data, measure == \"p_total\")) +\n  theme_bw(base_size = 12) +\n  geom_rect(data = df, aes(xmin = x1, xmax = x2, ymin = y1, ymax = y2, fill = difference), alpha = 0.15) +\n  #scale_fill_manual(values = c(\"white\", \"black\")) +\n  #ggnewscale::new_scale_fill() +\n  geom_boxplot(aes(x = treatment, y = diff, fill = location)) +\n  labs(y = expression(paste(\"Net WEP Difference (\", mg~m^{-2}, \")\")), x = \"Treatment\") +\n  #scale_fill_viridis_d(name = \"Location\", begin = 0.3, end = 1) +\n  scale_fill_manual(values = c(\"white\", \"black\", \"#35608DFF\", \"#2FB47CFF\", \"#FDE725FF\")) +\n  guides(fill = guide_legend(override.aes = list(colour = \"black\", size = 1))) +\n  theme(axis.title.x = element_blank(),\n        axis.text.x = element_text(angle = 0, vjust = 1, hjust = 0.5),\n        legend.position = \"bottom\",\n        legend.title = element_blank())\np1\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: Removed 11 rows containing non-finite outside the scale range\n(`stat_boxplot()`).\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: fig-litter-WEP\n#| fig-cap: \"Change in riparian litter WEP following grazing or mowing in each of the riparian locations. No significant effect of treatment or riparian location on the litter WEP content was detected. Lower sampling locations are adjacent to the edge of the waterbody and Upper locations are adjacent to the field.\"\n#| fig-alt: \"Boxplots showing the change in riparian litter WEP following grazing or mowing.\"\n#|\n# ggsave(plot = p1, filename = here::here(\"./Figures/Figure 4.png\"), width = 174, height = 85, units = \"mm\", dpi = 600)\n```\n\n::: {.cell-output-display}\n![Change in riparian litter WEP following grazing or mowing in each of the riparian locations. No significant effect of treatment or riparian location on the litter WEP content was detected. Lower sampling locations are adjacent to the edge of the waterbody and Upper locations are adjacent to the field.](02_Litter_analysis_files/figure-html/fig-litter-WEP-1.png){#fig-litter-WEP fig-alt='Boxplots showing the change in riparian litter WEP following grazing or mowing.' width=672}\n:::\n:::",
    "supporting": [
      "02_Litter_analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}