{
  "hash": "ccdf665be3ad93b021cbdf97dffdb50b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Map of study area\nauthor: Alex Koiter\n---\n\n\n\n\n\n\n\n\n\n## Load Libraries\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(ggspatial)\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nLinking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nlibrary(rnaturalearth)\nlibrary(patchwork)\nlibrary(OpenStreetMap)\n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Important coordinants \nRegional site location\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nsite <- st_sfc(st_point(c(-99.924176, 50.056015)), crs = 4326)\nbox = c(xmin = -99.99, xmax = -99.924176 + 0.12, ymax = 50.056015 +.065, ymin = 50.056015 - 0.065)\n```\n:::\n\n\n\n\n\n\n\n\n\n\nStudy plot locations\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n# sites <- st_as_sf(data.frame(site = c(1,2,3,4), lat = c(50.052525, 50.052209, 50.059208, 50.060235), long = c(-99.924242, -99.918429, -99.912849, -99.931591)), coords = c(\"long\", \"lat\"), crs = 4362)\n                                                                                              \nsites <- data.frame(site = c(1,2,3,4), lat = c(50.052525, 50.052209, 50.059208, 50.060235), long = c(-99.924242, -99.918429, -99.912849, -99.931591))\n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Land use data of region\n### Get data\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nminnedosa_data <- \"lcv_minnedosa_2004_2006_shp\"\nif (file.exists(minnedosa_data)) {\n  print(\"The data already exists!\")\n} else {\n  download.file(\"https://mli.gov.mb.ca/landuse/shp_zip_files/lcv_minnedosa_2004_2006_shp.zip\", \n                destfile = \"lcv_minnedosa_2004_2006_shp.zip\")\n  unzip(\"lcv_minnedosa_2004_2006_shp.zip\", exdir = \"lcv_minnedosa_2004_2006_shp\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"The data already exists!\"\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nbrandon_data <- \"lcv_brandon_2006_shp\"\nif (file.exists(brandon_data)) {\n  print(\"The data already exists!\")\n} else {\n  download.file(\"https://mli.gov.mb.ca/landuse/shp_zip_files/lcv_brandon_2006_shp.zip\", \n                destfile = \"lcv_brandon_2006_shp.zip\")\n  unzip(\"lcv_brandon_2006_shp.zip\", exdir = \"lcv_brandon_2006_shp\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"The data already exists!\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nsf_use_s2(FALSE)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nSpherical geometry (s2) switched off\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nland <- st_read(here::here(\"./notebooks/lcv_brandon_2006_shp/lcv_brandon_2006.shp\")) %>%\n  bind_rows(st_read(here::here(\"./notebooks/lcv_minnedosa_2004_2006_shp/lcv_minnedosa_2004_2006.shp\"))) %>%\n  st_transform(crs = 4326) %>%\n  st_crop(st_bbox(box, crs = 4326)) %>%\n  mutate(Land_use = recode(CLASSNAME, \"Agricultural Field\" = \"Agriculture\", \"Agri - Forage Field\" = \"Forage\", \"Water Body\" = \"Water\", \"Wetland - Treed Bog\" = \"Wetland\", \"Wetland - Marsh\" = \"Wetland\", \"Decidious Forest\" = \"Forest\", \"Open Decidious Forest\" = \"Forest\", \"Mixedwood Forest\" = \"Forest\", \"Forest Cut Blocks\" = \"Forest\", \"Coniferous Forest\" = \"Forest\",\"Roads Trails Rail Lines\" = \"Other\", \"Sand and Gravel\" = \"Other\", \"Cultural Features\" = \"Other\", \"Range and Grassland\" = \"Forage\", \"Water Bodies\" = \"Water\")) %>%\n  # group_by(Land_use) %>%\n  # summarise(do_union = TRUE) %>%\n  mutate(Land_use = factor(Land_use, levels=c(\"Agriculture\", \"Forage\", \"Forest\",  \"Water\", \"Wetland\", \"Other\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `lcv_brandon_2006' from data source \n  `/home/alex/Dropbox/MBFI/MBFI riparian study/riparian-grazing-manuscript/notebooks/lcv_brandon_2006_shp/lcv_brandon_2006.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 145146 features and 5 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 429971 ymin: 5427260 xmax: 510011 ymax: 5542070\nProjected CRS: UTM\nReading layer `lcv_minnedosa_2004_2006' from data source \n  `/home/alex/Dropbox/MBFI/MBFI riparian study/riparian-grazing-manuscript/notebooks/lcv_minnedosa_2004_2006_shp/lcv_minnedosa_2004_2006.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 160653 features and 5 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 429972 ymin: 5542070 xmax: 549972 ymax: 5656880\nProjected CRS: UTM\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nalthough coordinates are longitude/latitude, st_intersection assumes that they\nare planar\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## Canada\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\ncanada <- ne_states(country = \"Canada\", returnclass = \"sf\") %>%\n  st_transform(crs = 3348) \n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Maps\n### Land use\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\np3 <- ggplot() +\n  theme_bw() +\n  geom_sf(data = land, aes(fill = Land_use), lwd = 0) +\n  scale_fill_manual(values=c(\"#458B00\",  \"#CDAD00\", \"#006400\",\"#009ACD\", \"#0096D194\",  \"#C1CDCD\"), name = \"Land use\") +\n  geom_point(data = sites, aes(x = long, y = lat), shape = 23, colour = \"red\", fill = \"red\", size = 2) +\n  coord_sf(ylim = c(49.992, 50.1), xlim = c(-99.965, -99.80418), crs = 4326) +\n  scale_y_continuous(expand = c(0,0)) +\n  scale_x_continuous(expand = c(0,0)) +\n  labs(tag = \"b)\") +\n  annotation_scale(location = \"bl\",\n                   height = unit(0.05, \"cm\")) +\n  annotation_north_arrow(location = \"br\", \n                         height = unit(0.5, \"cm\"),\n                         width = unit(0.5, \"cm\")) +\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        axis.title = element_blank(),\n        plot.margin = unit(c(0,0,0,0), \"mm\"))\n```\n:::\n\n\n\n\n\n\n\n\n\n\n### Open street\nnot used\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\np2 <- ggplot(site) +\n  annotation_map_tile(type = \"osm\", zoom = 15) +\n  geom_point(data = sites, aes(x = long, y = lat), shape = 23, colour = \"red\", fill = \"red\", size = 1) +\n  #coord_sf(ylim = c(50.056015 +.02, 50.056015 - 0.02), xlim = c(-99.924176 - 0.04, -99.924176 + 0.04), crs = 4326) +\n  coord_sf(ylim = c(50.056015 +.01, 50.056015 +.065), xlim = c(-99.924176 - 0.02, -99.924176 + 0.02), crs = 4326) +\n  annotation_scale(location = \"bl\",\n                   height = unit(0.05, \"cm\")) +\n  annotation_north_arrow(location = \"br\", \n                         height = unit(0.5, \"cm\"),\n                         width = unit(0.5, \"cm\")) +\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        axis.title = element_blank(),\n        plot.margin = unit(c(0,0,0,0), \"mm\"))\n```\n:::\n\n\n\n\n\n\n\n\n\n### Canada\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\np1 <- ggplot() +\n  theme_bw() +\n  layer_spatial(canada, fill = \"white\") +\n  layer_spatial(site, shape = 23, colour = \"red\", fill = \"red\", size = 2) +\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        axis.title = element_blank(),\n        plot.margin = unit(c(0,0,0,0), \"mm\"),\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank(),\n        #panel.border = element_blank(),\n        panel.background = element_blank())\n```\n:::\n\n::: {#cell-fig-map .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-map\n#| fig-cap: \"Showing a) the study site in southwestern Manitoba and b) the four riparian areas included in this study and the regional land use (data from https://mli.gov.mb.ca/).\"\n#| fig-alt: \"Map of Canada with red dot showing location of stite. Regional landuse with red dots showing the location of the four riparian areas included in this study\"\n#|   \np1 + p3 + plot_layout(guides = \"collect\") & theme(legend.position = \"right\")\n\n#ggsave(filename = \"Figures/Maps.png\", plot = p4, height = 75, width = 180, units = \"mm\", dpi = 600)\n```\n\n::: {.cell-output-display}\n![Showing a) the study site in southwestern Manitoba and b) the four riparian areas included in this study and the regional land use (data from https://mli.gov.mb.ca/).](05_Map_files/figure-jats/fig-map-1.png){#fig-map fig-alt='Map of Canada with red dot showing location of stite. Regional landuse with red dots showing the location of the four riparian areas included in this study'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\nmb_river <- ne_download(scale = 10,  type = 'rivers_lake_centerlines', category = \"physical\", returnclass = \"sf\") %>%\n  st_transform(crs = 4326) %>%\n  st_crop(st_bbox(c(xmin = -101.5889, ymin = 48.99267, \n                    xmax = -95.15399, ymax = 51.399), \n                  crs = st_crs(.)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `ne_10m_rivers_lake_centerlines' from data source \n  `/tmp/RtmpZlDvEm/ne_10m_rivers_lake_centerlines.shp' using driver `ESRI Shapefile'\nSimple feature collection with 1473 features and 38 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: -164.9035 ymin: -52.15775 xmax: 177.5204 ymax: 75.79348\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nalthough coordinates are longitude/latitude, st_intersection assumes that they\nare planar\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nmb_lakes <- ne_download(scale = 10,  type = 'lakes', category = \"physical\", returnclass = \"sf\") %>%\n  st_transform(crs = 4326) %>%\n  st_crop(st_bbox(c(xmin = -101.5889, ymin = 48.99267, \n                    xmax = -95.15399, ymax = 51.399), \n                  crs = st_crs(.)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `ne_10m_lakes' from data source `/tmp/RtmpZlDvEm/ne_10m_lakes.shp' using driver `ESRI Shapefile'\nSimple feature collection with 1355 features and 41 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -165.9656 ymin: -50.66967 xmax: 177.1544 ymax: 81.95521\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nalthough coordinates are longitude/latitude, st_intersection assumes that they\nare planar\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nmb <- ne_states(country = \"Canada\", returnclass = \"sf\") %>%\n  filter(name == \"Manitoba\") %>%\n  st_transform(crs = 4326) %>%\n  st_crop(st_bbox(c(xmin = -101.5889, ymin = 48.99267, \n                    xmax = -95.15399, ymax = 51.399), \n                  crs = st_crs(.)))\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nalthough coordinates are longitude/latitude, st_intersection assumes that they\nare planar\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\nmb_cities <- maps::canada.cities %>%\n  filter(country.etc == \"MB\") %>%\n  mutate(name = str_remove(name, \" [A-Z]{2}$\")) %>%\n  st_as_sf(coords = c(\"long\", \"lat\"), crs = 4326) %>%\n  st_transform(crs = 4326) %>%\n  st_crop(st_bbox(c(xmin = -101.5889, ymin = 48.99267, \n                    xmax = -95.15399, ymax = 51.399), \n                  crs = st_crs(.))) %>%\n  filter(pop >5000)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nalthough coordinates are longitude/latitude, st_intersection assumes that they\nare planar\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\np4 <- ggplot() +\n  theme_bw() +\n  geom_sf(data = mb, fill = \"white\") +\n  geom_sf(data = mb_river, colour = \"skyblue4\") +\n    geom_sf(data = mb_lakes, fill = \"lightblue\") +\n  geom_sf(data = mb_cities) +\n  ggrepel::geom_label_repel(\n    data = mb_cities,\n    aes(label = name, geometry = geometry),\n    stat = \"sf_coordinates\",\n    min.segment.length = 0,\n    nudge_y = 0.02,\n    size = 2\n  ) +\n  layer_spatial(site, shape = 23, colour = \"red\", fill = \"red\", size = 2) +\n  labs(tag = \"a)\") +\n  annotation_scale(location = \"bl\",\n                   height = unit(0.05, \"cm\"), \n                   pad_y = unit(0.5, \"cm\"),\n                   pad_x = unit(1.1, \"cm\")) +\n  annotation_north_arrow(location = \"br\", \n                         height = unit(0.5, \"cm\"),\n                         width = unit(0.5, \"cm\"), \n                   pad_y = unit(0.5, \"cm\"),\n                   pad_x = unit(1.1, \"cm\")) +\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        axis.title = element_blank(),\n        plot.margin = unit(c(0,0,0,0), \"mm\"),\n        panel.grid.major = element_blank(),\n        panel.grid.minor = element_blank(),\n        panel.border = element_blank(),\n        panel.background = element_blank())\n\n\n\nmap <- openmap(c(50.047, -99.936), c( 50.065, -99.909), zoom = NULL,\n                  type = \"esri-imagery\", mergeTiles = TRUE) \n\nsa_map2 <- openproj(map, projection = \"+proj=longlat +datum=WGS84 +no_defs +type=crs\")\n\nsites <- data.frame(sites = c(\"1\", \"2\", \"3\", \"4\"), lat = c(50.052472, 50.052288, 50.059197, 50.060114), long = c(-99.924327, -99.918839, -99.912919, -99.931479)) \n\n\np5 <- OpenStreetMap::autoplot.OpenStreetMap(sa_map2) +\n  theme_void() +\n  geom_point(data = sites,\n           aes(x = long , y = lat ), \n           colour = \"red\", size =  2.5) +\n  ggrepel::geom_label_repel(data = sites, \n            aes(long, lat, label = sites), \n            size = 3, colour = \"black\",\n            min.segment.length = 0) + \n  geom_segment(aes(x = -99.934824, y = 50.048, xend = -99.927655, yend = 50.048), colour = \"black\", linewidth = 1) +\n  geom_segment(aes(x = -99.931150, y = 50.048, xend = -99.927655, yend = 50.048), colour = \"white\", linewidth = 1) +\n  annotate(\"label\", x = -99.926, y = 50.048, label = \"500m\", fill = \"lightgray\") +\n  labs(tag = \"b)\")\n```\n:::\n\n::: {#cell-fig-mapr .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-mapr\n#| fig-cap: \"Showing a) the location of the study site in southern Manitoba with an inset map of Canada; and b) the locations of the four riparian areas included in this study\"\n#| fig-alt: \"Map of Southern Manitba with an inset map of Canada with red dot showing location of site. Satellite imagery of the locations of the four riparian areas included in this study\"\n\np6 <- p4 + inset_element(p1, left = 0.6, bottom = 0.6, right = 1, top = 1) + p5\np6\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning in st_point_on_surface.sfc(sf::st_zm(x)): st_point_on_surface may not\ngive correct results for longitude/latitude data\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| label: fig-mapr\n#| fig-cap: \"Showing a) the location of the study site in southern Manitoba with an inset map of Canada; and b) the locations of the four riparian areas included in this study\"\n#| fig-alt: \"Map of Southern Manitba with an inset map of Canada with red dot showing location of site. Satellite imagery of the locations of the four riparian areas included in this study\"\n\n#ggsave(plot = p6, filename = here::here(\"./Figures/Figure 1.png\"), width = 174, height = 100, units = \"mm\", dpi = 600) \n```\n\n::: {.cell-output-display}\n![Showing a) the location of the study site in southern Manitoba with an inset map of Canada; and b) the locations of the four riparian areas included in this study](05_Map_files/figure-jats/fig-mapr-1.png){#fig-mapr fig-alt='Map of Southern Manitba with an inset map of Canada with red dot showing location of site. Satellite imagery of the locations of the four riparian areas included in this study'}\n:::\n:::\n",
    "supporting": [
      "05_Map_files/figure-jats"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}